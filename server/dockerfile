FROM node:alpine as install

COPY package.json .

RUN npm install

FROM oven/bun as build

COPY . .

COPY --from=install node_modules node_modules

RUN bun run buildnode

FROM install as production

COPY --from=build ./index.js .

COPY --from=install node_modules .

COPY prisma ./prisma

RUN npx prisma generate

EXPOSE 8000
ENTRYPOINT [ "node", "index.js" ]
